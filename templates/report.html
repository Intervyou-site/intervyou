<!doctype html>
<html lang="en" x-data="reportPage()" x-init="init()" :class="dark ? 'dark' : ''">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üìä Report ‚Äî IntervYou</title>

  <!-- Tailwind + Alpine.js + Chart.js -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap');
    :root { --card-bg: rgba(255,255,255,1); --muted: #64748b; }
    .dark :root { --card-bg: #0f1724; --muted: #94a3b8; }

    body { font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; }
    [x-cloak]{display:none!important;}

    /* animated gradient */
    @keyframes gradientMove {
      0%,100% { background-position: 0% 50%; }
      50% { background-position: 100% 50%; }
    }
    .animate-gradient { background-size: 200% 200%; animation: gradientMove 12s ease infinite; }

    /* entrance */
    .fade-slide-up { opacity: 0; transform: translateY(18px); animation: fadeUp 0.9s ease forwards; }
    @keyframes fadeUp { to { opacity: 1; transform: translateY(0); } }

    /* subtle hover glow for cards */
    .card-hover {
      transition: box-shadow .25s, transform .15s;
    }
    .card-hover:hover {
      transform: translateY(-6px);
      box-shadow: 0 18px 40px rgba(15,23,42,0.12);
    }

    /* circular average badge */
    .avg-ring {
      width:72px; height:72px; border-radius:999px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, rgba(99,102,241,0.12), rgba(6,182,212,0.08));
      border: 2px solid rgba(99,102,241,0.12);
    }
    .dark .avg-ring { background: linear-gradient(135deg, rgba(99,102,241,0.08), rgba(6,182,212,0.05)); border-color: rgba(99,102,241,0.18); }
  </style>
</head>
<body class="bg-gray-50 dark:bg-slate-900 text-slate-900 dark:text-slate-100 antialiased">

  <!-- NAVBAR -->
  <nav class="fixed top-0 left-0 w-full z-50 px-6 py-4 bg-transparent flex items-center justify-between">
    <div class="flex items-center gap-3 cursor-pointer hover:scale-105 transition-transform" @click="goHome">
      <div class="w-10 h-10 rounded-lg bg-gradient-to-br from-sky-400 to-blue-500 grid place-items-center text-white font-bold shadow">AI</div>
      <div class="text-white font-semibold drop-shadow">IntervYou</div>
    </div>
  </nav>

  <!-- Profile Icon - Top Right Corner -->
  <a href="/profile" class="fixed top-6 right-6 z-[1001] group" aria-label="Profile">
    <div class="w-12 h-12 rounded-full bg-white dark:bg-slate-800 border-2 border-sky-400 dark:border-sky-500 
                flex items-center justify-center shadow-lg hover:shadow-xl transition-all duration-300 
                hover:scale-110 cursor-pointer backdrop-blur-sm">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-sky-500 dark:text-sky-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
      </svg>
    </div>
    <!-- Tooltip -->
    <div class="absolute top-full right-0 mt-2 px-3 py-1 bg-slate-900 text-white text-sm rounded-lg 
                opacity-0 group-hover:opacity-100 transition-opacity duration-200 whitespace-nowrap pointer-events-none">
      Profile
    </div>
  </a>

  <!-- HERO -->
  <header class="relative min-h-[28vh] flex items-end">
    <div class="absolute inset-0 bg-gradient-to-r from-indigo-500 via-sky-400 to-emerald-300 animate-gradient"></div>
    <div class="absolute inset-0 bg-black/22"></div>

    <div class="relative z-10 max-w-7xl mx-auto px-6 pb-8">
      <h1 class="text-4xl font-extrabold text-white mb-2">üìä Performance Report</h1>
      <p class="text-white/90 max-w-2xl">Your recent performance summary ‚Äî clear trends and category insights to guide your practice.</p>
    </div>
  </header>

  <!-- MAIN -->
  <main class="max-w-7xl mx-auto px-6 -mt-10 pb-20">
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">

      <!-- Main content: stacked charts -->
      <section class="lg:col-span-2 fade-slide-up">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl p-8 border border-slate-100 dark:border-slate-700">
          <!-- Top summary row -->
          <div class="flex items-center justify-between gap-6">
            <div>
              <h2 class="text-lg font-semibold text-slate-800 dark:text-white">Session Summary</h2>
              <p class="text-sm text-slate-500 dark:text-slate-300 mt-1">{{ remark or 'Keep practicing to build consistency.' }}</p>
            </div>

            <div class="flex items-center gap-6">
              <div class="text-right">
                <div class="text-xs text-slate-400">Average Score</div>
                <div class="text-2xl font-extrabold text-indigo-600 dark:text-indigo-400">{{ average or 0 }}/10</div>
                <div class="text-xs text-slate-400 mt-1">{{ attempts|length if attempts else 0 }} recent attempts</div>
              </div>

              <!-- circular badge -->
              <div class="avg-ring">
                <div class="text-sm font-bold text-indigo-600 dark:text-indigo-400">{{ average or 0 }}</div>
                <div class="text-[10px] text-slate-400">/10</div>
              </div>
            </div>
          </div>

          <!-- stacked charts -->
          <div class="mt-6 space-y-6">
            <!-- Recent Scores chart card -->
            <div class="p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-100 dark:border-slate-700 card-hover">
              <div class="flex items-center justify-between">
                <div>
                  <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-200">üìà Recent Scores</h3>
                  <div class="text-xs text-slate-400">Last {{ (attempts|length if attempts else 0) }} attempts</div>
                </div>
                <div class="text-xs text-slate-400">Trend overview</div>
              </div>
              <div class="mt-4">
                <canvas id="trendChart" height="160"></canvas>
              </div>
            </div>

            <!-- Category Strengths chart card -->
            <div class="p-4 rounded-xl bg-slate-50 dark:bg-slate-900 border border-slate-100 dark:border-slate-700 card-hover">
              <div class="flex items-center justify-between">
                <div>
                  <h3 class="text-sm font-semibold text-slate-700 dark:text-slate-200">üß≠ Category Strengths</h3>
                  <div class="text-xs text-slate-400">Your average per category</div>
                </div>
                <div class="text-xs text-slate-400">Compare categories</div>
              </div>
              <div class="mt-4">
                {% if category_labels and category_scores %}
                  <canvas id="radarChart" height="220"></canvas>
                {% else %}
                  <div class="text-sm text-slate-500 dark:text-slate-300 p-6 rounded-lg bg-white/50 dark:bg-slate-800/50">
                    No category data available yet. Practice across categories to populate this chart.
                  </div>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Sidebar -->
      <aside class="space-y-6 fade-slide-up" style="animation-delay:.15s">
        <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg p-6 border border-slate-100 dark:border-slate-700">
          <h4 class="text-sm font-semibold text-slate-700 dark:text-slate-300">üéØ Quick Insights</h4>
          <ul class="mt-3 text-sm text-slate-600 dark:text-slate-300 space-y-2">
            <li>‚Ä¢ Focus 60% of practice time on your weakest categories.</li>
            <li>‚Ä¢ Reduce filler words to improve fluency score.</li>
            <li>‚Ä¢ Aim for 8+/10 across 3 consecutive attempts to unlock a badge.</li>
          </ul>
        </div>

        <div class="bg-gradient-to-br from-sky-50 to-white dark:from-slate-700 dark:to-slate-800 rounded-2xl shadow-lg p-6">
          <h4 class="text-sm font-semibold text-sky-700 dark:text-sky-300 mb-3">üèÜ Top Learners</h4>
          <ul class="space-y-2 text-sm text-slate-700 dark:text-slate-200">
            {% if top_learners %}
              {% for learner in top_learners %}
                <li class="flex justify-between">
                  <span>{{ learner.name }}</span>
                  <span class="font-semibold">{{ learner.avg }}</span>
                </li>
              {% endfor %}
            {% else %}
              <li class="text-slate-500 dark:text-slate-400 text-center py-2">No data yet</li>
            {% endif %}
          </ul>
        </div>
      </aside>
    </div>
  </main>

  <footer class="text-center text-sm text-white/80 py-6 mt-6 relative z-10">¬© {{ now().year if now else '2025' }} IntervYou ‚Äî Practice. Improve. Succeed.</footer>

  <!-- Charts initialization -->
  <script>
    function reportPage(){
      return {
        dark: false,
        init(){
          const saved = localStorage.getItem('iv_theme');
          this.dark = saved === 'dark';
          document.documentElement.classList.toggle('dark', this.dark);

          // Initialize charts slightly after render
          setTimeout(()=> this.initCharts(), 100);
        },
        goHome(){ window.location.href = '/'; },
        toggleTheme(){
          this.dark = !this.dark;
          localStorage.setItem('iv_theme', this.dark ? 'dark' : 'light');
          document.documentElement.classList.toggle('dark', this.dark);
        },
        initCharts(){
          // Recent trend
          const tLabels = {{ chart_labels|tojson|safe }};
          const tData = {{ chart_scores|tojson|safe }};

          if(document.getElementById('trendChart') && Array.isArray(tLabels) && tLabels.length){
            new Chart(document.getElementById('trendChart'), {
              type: 'line',
              data: {
                labels: tLabels,
                datasets: [{
                  label: 'Score',
                  data: tData,
                  fill: true,
                  backgroundColor: 'rgba(99,102,241,0.08)',
                  borderColor: 'rgba(99,102,241,0.95)',
                  tension: 0.25,
                  pointRadius: 4,
                  pointBackgroundColor: 'rgba(99,102,241,0.95)',
                }]
              },
              options: {
                responsive: true,
                scales: {
                  y: { beginAtZero: true, max: 10, ticks: { stepSize: 1 } },
                  x: { ticks: { autoSkip: true, maxRotation: 0 } }
                },
                plugins: { legend: { display: false } }
              }
            });
          } else {
            // draw empty placeholder line if needed (silently)
          }

          // Radar: category strengths
          {% if category_labels and category_scores %}
          const cLabels = {{ category_labels|tojson|safe }};
          const cData = {{ category_scores|tojson|safe }};
          if(document.getElementById('radarChart') && Array.isArray(cLabels) && cLabels.length){
            new Chart(document.getElementById('radarChart'), {
              type: 'radar',
              data: {
                labels: cLabels,
                datasets: [{
                  label: 'Category average',
                  data: cData,
                  backgroundColor: 'rgba(99,102,241,0.12)',
                  borderColor: 'rgba(99,102,241,0.95)',
                  pointBackgroundColor: 'rgba(99,102,241,0.95)',
                  pointRadius: 4,
                  borderWidth: 2,
                }]
              },
              options: {
                responsive: true,
                scales: {
                  r: {
                    beginAtZero: true,
                    suggestedMax: 10,
                    grid: { color: 'rgba(15,23,42,0.06)' },
                    angleLines: { color: 'rgba(15,23,42,0.06)' }
                  }
                },
                plugins: { legend: { display: false } }
              }
            });
          }
          {% endif %}
        }
      }
    }
  </script>
</body>
</html>
