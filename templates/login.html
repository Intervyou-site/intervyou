{# templates/login.html #}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Login - IntervYou</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="{{ url_for('static', path='style.css') }}?v=uniform7">
  <link rel="stylesheet" href="{{ url_for('static', path='password-beam.css') }}">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
</head>
<body>
  <!-- Corner Home Button -->
  <a href="/" style="position:fixed;left:18px;top:18px;z-index:1000;text-decoration:none;">
    <div style="width:56px;height:56px;border-radius:10px;display:grid;place-items:center;
                background:linear-gradient(135deg,#38bdf8,#0ea5e9);box-shadow:0 5px 18px rgba(0,0,0,0.4);">
      <strong style="color:white;font-family:inherit;">AI</strong>
    </div>
  </a>

  <div class="container" id="authContainer" style="--S:1; --D:2; --li:3;">
    <div class="curved-shape"></div>
    <div class="curved-shape2"></div>

    <!-- LOGIN FORM -->
    <div class="form-box Login">
      <div class="animation">
        <h2>Login</h2>

        {% if flashes %}
          {% for f in flashes %}
            <div style="margin:12px 0; padding:12px; background:rgba(255,255,255,0.05); border-radius:8px; color:#fff;">
              {{ f.msg }}
            </div>
          {% endfor %}
        {% endif %}

        <form action="/login" method="post" novalidate id="loginForm">
          <div class="input-box">
            <input id="email" type="email" name="email" required value="{{ request.form.email or '' }}" placeholder=" " autocomplete="email" inputmode="email">
            <label for="email">Username or Email</label>
            <box-icon type='solid' name='user'></box-icon>
          </div>

          <div class="input-box">
            <input id="password" type="password" name="password" required placeholder=" " autocomplete="current-password">
            <label for="password">Password</label>
            <box-icon name='lock-alt' type='solid'></box-icon>
          </div>

          <div class="input-box" style="margin-top:20px;">
            <button class="btn" type="submit" id="loginBtn">Login</button>
          </div>

          <!-- Social Login Buttons -->
          <div style="margin-top:20px;">
            <div style="text-align:center;margin-bottom:12px;color:rgba(255,255,255,0.6);font-size:13px;">Or continue with</div>
            <div style="display:flex;gap:10px;justify-content:center;">
              <a href="/auth/google" style="padding:12px 24px;background:rgba(255,255,255,0.1);border-radius:8px;text-align:center;text-decoration:none;color:#fff;border:1px solid rgba(255,255,255,0.2);transition:all 0.3s;display:flex;align-items:center;gap:8px;justify-content:center;" onmouseover="this.style.background='rgba(255,255,255,0.15)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                <box-icon name='google' type='logo' color='#fff' size='20px'></box-icon>
                <span>Sign in with Google</span>
              </a>
            </div>
          </div>

          <!-- Links -->
          <div class="regi-link" style="margin-top:16px;">
            <p style="margin-bottom:6px;">
              <a href="/forgot_password" style="color:var(--accent2);font-weight:600;text-decoration:none;">Forgot password?</a>
            </p>
            <p>
              Don't have an account?
              <a href="#" class="SignUpLink" data-mode="register" style="color:var(--accent2);font-weight:600;">Sign Up</a>
            </p>
          </div>
        </form>
      </div>
    </div>

    <!-- INFO RIGHT -->
    <div class="info-content Login">
      <div class="animation">
        <h2>WELCOME BACK!</h2>
        <p>We are happy to have you with us again. If you need anything, we are here to help.</p>
      </div>
    </div>

    <!-- REGISTER FORM (Hidden) -->
    <div class="form-box Register">
      <div class="animation">
        <h2>Register</h2>
        <form action="/register" method="post" novalidate>
          <div class="input-box">
            <input id="reg_name" type="text" name="name" required placeholder=" ">
            <label for="reg_name">Username</label>
            <box-icon type='solid' name='user'></box-icon>
          </div>

          <div class="input-box">
            <input id="reg_email" type="email" name="email" required placeholder=" ">
            <label for="reg_email">Email</label>
            <box-icon name='envelope' type='solid'></box-icon>
          </div>

          <div class="input-box">
            <input id="reg_password" type="password" name="password" required placeholder=" ">
            <label for="reg_password">Password</label>
            <box-icon name='lock-alt' type='solid'></box-icon>
          </div>

          <div class="input-box" style="margin-top:20px;">
            <button class="btn" type="submit">Register</button>
          </div>

          <!-- Social Login Buttons -->
          <div style="margin-top:20px;">
            <div style="text-align:center;margin-bottom:12px;color:rgba(255,255,255,0.6);font-size:13px;">Or sign up with</div>
            <div style="display:flex;gap:10px;justify-content:center;">
              <a href="/auth/google" style="padding:12px 24px;background:rgba(255,255,255,0.1);border-radius:8px;text-align:center;text-decoration:none;color:#fff;border:1px solid rgba(255,255,255,0.2);transition:all 0.3s;display:flex;align-items:center;gap:8px;justify-content:center;" onmouseover="this.style.background='rgba(255,255,255,0.15)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                <box-icon name='google' type='logo' color='#fff' size='20px'></box-icon>
                <span>Sign up with Google</span>
              </a>
            </div>
          </div>

          <div class="regi-link" style="margin-top:16px;">
            <p>
              Already registered?
              <a href="#" class="SignInLink" data-mode="login" style="color:var(--accent2);font-weight:600;">Sign In</a>
            </p>
          </div>
        </form>
      </div>
    </div>

    <!-- INFO LEFT -->
    <div class="info-content Register">
      <div class="animation">
        <h2>WELCOME!</h2>
        <p>Weâ€™re delighted to have you here. If you need any assistance, feel free to reach out.</p>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
  <script src="{{ url_for('static', path='script.js') }}"></script>
  <script src="{{ url_for('static', path='password-beam.js') }}"></script>
  <script>
    // Fix label position on page load for pre-filled inputs
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.input-box input').forEach(input => {
        if (input.value && input.value.trim() !== '') {
          input.classList.add('has-value');
        }
        
        input.addEventListener('input', function() {
          if (this.value && this.value.trim() !== '') {
            this.classList.add('has-value');
          } else {
            this.classList.remove('has-value');
          }
        });
      });
    });
  </script>

  <!-- Mobile Login Enhancement -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('loginForm');
      const btn = document.getElementById('loginBtn');
      const emailInput = document.getElementById('email');
      const passwordInput = document.getElementById('password');
      
      if (form && btn) {
        // Prevent double submission
        let isSubmitting = false;
        
        // Add visual feedback on mobile
        btn.addEventListener('touchstart', function(e) {
          this.style.opacity = '0.8';
        }, {passive: true});
        
        btn.addEventListener('touchend', function(e) {
          this.style.opacity = '1';
        }, {passive: true});
        
        // Handle form submission - use standard form submission
        form.addEventListener('submit', function(e) {
          // Prevent double submission
          if (isSubmitting) {
            e.preventDefault();
            return false;
          }
          
          const email = emailInput.value.trim();
          const password = passwordInput.value;
          
          // Validation
          if (!email || !password) {
            e.preventDefault();
            alert('Please enter both email and password');
            return false;
          }
          
          // Show loading state
          isSubmitting = true;
          btn.textContent = 'Logging in...';
          btn.disabled = true;
          btn.style.opacity = '0.7';
          
          // Let form submit normally
          return true;
        });
        
        // Fix iOS Safari input issues
        [emailInput, passwordInput].forEach(input => {
          if (input) {
            input.addEventListener('focus', function() {
              // Scroll input into view on mobile
              setTimeout(() => {
                this.scrollIntoView({behavior: 'smooth', block: 'center'});
              }, 300);
            });
          }
        });
      }
    });
  </script>
</body>
</html>
