{# templates/login.html #}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Login - IntervYou</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="{{ url_for('static', path='style.css') }}?v=uniform7">
  <link rel="stylesheet" href="{{ url_for('static', path='password-beam.css') }}">
  <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet" />
</head>
<body>
  <!-- Corner Home Button -->
  <a href="/" style="position:fixed;left:18px;top:18px;z-index:1000;text-decoration:none;">
    <div style="width:56px;height:56px;border-radius:10px;display:grid;place-items:center;
                background:linear-gradient(135deg,#38bdf8,#0ea5e9);box-shadow:0 5px 18px rgba(0,0,0,0.4);">
      <strong style="color:white;font-family:inherit;">AI</strong>
    </div>
  </a>

  <div class="container" id="authContainer" style="--S:1; --D:2; --li:3;">
    <div class="curved-shape"></div>
    <div class="curved-shape2"></div>

    <!-- LOGIN FORM -->
    <div class="form-box Login">
      <div class="animation">
        <h2>Login</h2>

        {% if flashes %}
          {% for f in flashes %}
            <div style="margin:12px 0; padding:12px; background:rgba(255,255,255,0.05); border-radius:8px; color:#fff;">
              {{ f.msg }}
            </div>
          {% endfor %}
        {% endif %}

        <form action="/login" method="post" novalidate id="loginForm">
          <div class="input-box">
            <input id="email" type="email" name="email" required value="{{ request.form.email or '' }}" placeholder=" " autocomplete="email" inputmode="email">
            <label for="email">Username or Email</label>
            <box-icon type='solid' name='user'></box-icon>
          </div>

          <div class="input-box">
            <input id="password" type="password" name="password" required placeholder=" " autocomplete="current-password">
            <label for="password">Password</label>
            <box-icon name='lock-alt' type='solid'></box-icon>
            <box-icon name='hide' type='solid' class='toggle-password' id='toggleLoginPassword' style='position:absolute;right:15px;top:50%;transform:translateY(-50%);cursor:pointer;color:#999;'></box-icon>
          </div>

          <div class="input-box" style="margin-top:20px;">
            <button class="btn" type="submit" id="loginBtn">Login</button>
          </div>

          <!-- Social Login Buttons -->
          <div style="margin-top:20px;">
            <div style="text-align:center;margin-bottom:12px;color:rgba(255,255,255,0.6);font-size:13px;">Or continue with</div>
            <div style="display:flex;gap:10px;justify-content:center;">
              <a href="/auth/google" style="padding:12px 24px;background:rgba(255,255,255,0.1);border-radius:8px;text-align:center;text-decoration:none;color:#fff;border:1px solid rgba(255,255,255,0.2);transition:all 0.3s;display:flex;align-items:center;gap:8px;justify-content:center;" onmouseover="this.style.background='rgba(255,255,255,0.15)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                <box-icon name='google' type='logo' color='#fff' size='20px'></box-icon>
                <span>Sign in with Google</span>
              </a>
            </div>
          </div>

          <!-- Links -->
          <div class="regi-link" style="margin-top:16px;">
            <p style="margin-bottom:6px;">
              <a href="/forgot_password" style="color:var(--accent2);font-weight:600;text-decoration:none;">Forgot password?</a>
            </p>
            <p>
              Don't have an account?
              <a href="#" class="SignUpLink" data-mode="register" style="color:var(--accent2);font-weight:600;">Sign Up</a>
            </p>
          </div>
        </form>
      </div>
    </div>

    <!-- INFO RIGHT -->
    <div class="info-content Login">
      <div class="animation">
        <h2>WELCOME BACK!</h2>
        <p>We are happy to have you with us again. If you need anything, we are here to help.</p>
      </div>
    </div>

    <!-- REGISTER FORM (Hidden) -->
    <div class="form-box Register">
      <div class="animation">
        <h2>Register</h2>
        <form action="/register" method="post" novalidate>
          <div class="input-box">
            <input id="reg_name" type="text" name="name" required placeholder=" " minlength="2">
            <label for="reg_name">Username</label>
            <box-icon type='solid' name='user'></box-icon>
          </div>
          <div class="error-message" id="reg_name_error" style="color:#ff4444;font-size:12px;margin-top:5px;display:none;"></div>

          <div class="input-box">
            <input id="reg_email" type="email" name="email" required placeholder=" ">
            <label for="reg_email">Email</label>
            <box-icon name='envelope' type='solid'></box-icon>
          </div>
          <div class="error-message" id="reg_email_error" style="color:#ff4444;font-size:12px;margin-top:5px;display:none;"></div>

          <div class="input-box">
            <input id="reg_password" type="password" name="password" required placeholder=" " autocomplete="new-password">
            <label for="reg_password">Password</label>
            <box-icon name='lock-alt' type='solid'></box-icon>
            <box-icon name='hide' type='solid' class='toggle-password' id='toggleRegPassword' style='position:absolute;right:15px;top:50%;transform:translateY(-50%);cursor:pointer;color:#999;'></box-icon>
          </div>
          <div class="error-message" id="reg_password_error" style="color:#ff4444;font-size:12px;margin-top:5px;display:none;"></div>
          
          <!-- Password Strength Meter -->
          <div id="passwordStrength" style="margin-top:10px;display:none;">
            <div style="height:4px;background:#e5e7eb;border-radius:2px;overflow:hidden;margin-bottom:8px;">
              <div id="strengthBar" style="height:100%;width:0%;transition:all 0.3s;border-radius:2px;"></div>
            </div>
            <div id="strengthText" style="font-size:12px;color:#6b7280;"></div>
          </div>

          <!-- Password Requirements -->
          <div id="passwordRequirements" style="margin-top:10px;padding:12px;background:rgba(255,255,255,0.05);border-radius:8px;font-size:12px;display:none;">
            <div class="requirement" id="req_length" style="display:flex;align-items:center;margin-bottom:6px;color:rgba(255,255,255,0.6);">
              <box-icon name='x-circle' size='16px' style='margin-right:8px;'></box-icon>
              <span>At least 8 characters</span>
            </div>
            <div class="requirement" id="req_uppercase" style="display:flex;align-items:center;margin-bottom:6px;color:rgba(255,255,255,0.6);">
              <box-icon name='x-circle' size='16px' style='margin-right:8px;'></box-icon>
              <span>One uppercase letter</span>
            </div>
            <div class="requirement" id="req_lowercase" style="display:flex;align-items:center;margin-bottom:6px;color:rgba(255,255,255,0.6);">
              <box-icon name='x-circle' size='16px' style='margin-right:8px;'></box-icon>
              <span>One lowercase letter</span>
            </div>
            <div class="requirement" id="req_number" style="display:flex;align-items:center;margin-bottom:6px;color:rgba(255,255,255,0.6);">
              <box-icon name='x-circle' size='16px' style='margin-right:8px;'></box-icon>
              <span>One number</span>
            </div>
            <div class="requirement" id="req_special" style="display:flex;align-items:center;color:rgba(255,255,255,0.6);">
              <box-icon name='x-circle' size='16px' style='margin-right:8px;'></box-icon>
              <span>One special character (!@#$%^&*)</span>
            </div>
          </div>

          <div class="input-box">
            <input id="reg_confirm_password" type="password" name="confirm_password" required placeholder=" " autocomplete="new-password">
            <label for="reg_confirm_password">Confirm Password</label>
            <box-icon name='lock-alt' type='solid'></box-icon>
            <box-icon name='hide' type='solid' class='toggle-password' id='toggleConfirmPassword' style='position:absolute;right:15px;top:50%;transform:translateY(-50%);cursor:pointer;color:#999;'></box-icon>
          </div>
          <div class="error-message" id="reg_confirm_password_error" style="color:#ff4444;font-size:12px;margin-top:5px;display:none;"></div>

          <div class="input-box" style="margin-top:20px;">
            <button class="btn" type="submit" id="registerBtn">Register</button>
          </div>

          <!-- Social Login Buttons -->
          <div style="margin-top:20px;">
            <div style="text-align:center;margin-bottom:12px;color:rgba(255,255,255,0.6);font-size:13px;">Or sign up with</div>
            <div style="display:flex;gap:10px;justify-content:center;">
              <a href="/auth/google" style="padding:12px 24px;background:rgba(255,255,255,0.1);border-radius:8px;text-align:center;text-decoration:none;color:#fff;border:1px solid rgba(255,255,255,0.2);transition:all 0.3s;display:flex;align-items:center;gap:8px;justify-content:center;" onmouseover="this.style.background='rgba(255,255,255,0.15)'" onmouseout="this.style.background='rgba(255,255,255,0.1)'">
                <box-icon name='google' type='logo' color='#fff' size='20px'></box-icon>
                <span>Sign up with Google</span>
              </a>
            </div>
          </div>

          <div class="regi-link" style="margin-top:16px;">
            <p>
              Already registered?
              <a href="#" class="SignInLink" data-mode="login" style="color:var(--accent2);font-weight:600;">Sign In</a>
            </p>
          </div>
        </form>
      </div>
    </div>

    <!-- INFO LEFT -->
    <div class="info-content Register">
      <div class="animation">
        <h2>WELCOME!</h2>
        <p>Weâ€™re delighted to have you here. If you need any assistance, feel free to reach out.</p>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/boxicons@2.1.4/dist/boxicons.js"></script>
  <script src="{{ url_for('static', path='script.js') }}"></script>
  <script src="{{ url_for('static', path='password-beam.js') }}"></script>
  <script>
    // Fix label position on page load for pre-filled inputs
    document.addEventListener('DOMContentLoaded', function() {
      document.querySelectorAll('.input-box input').forEach(input => {
        if (input.value && input.value.trim() !== '') {
          input.classList.add('has-value');
        }
        
        input.addEventListener('input', function() {
          if (this.value && this.value.trim() !== '') {
            this.classList.add('has-value');
          } else {
            this.classList.remove('has-value');
          }
        });
      });
    });
  </script>

  <!-- Password Toggle & Validation -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Password visibility toggle
      function setupPasswordToggle(toggleId, inputId) {
        const toggle = document.getElementById(toggleId);
        const input = document.getElementById(inputId);
        
        if (toggle && input) {
          toggle.addEventListener('click', function() {
            const type = input.type === 'password' ? 'text' : 'password';
            input.type = type;
            this.setAttribute('name', type === 'password' ? 'hide' : 'show');
          });
        }
      }

      setupPasswordToggle('toggleLoginPassword', 'password');
      setupPasswordToggle('toggleRegPassword', 'reg_password');
      setupPasswordToggle('toggleConfirmPassword', 'reg_confirm_password');

      // Password strength checker
      const regPassword = document.getElementById('reg_password');
      const passwordStrength = document.getElementById('passwordStrength');
      const passwordRequirements = document.getElementById('passwordRequirements');
      const strengthBar = document.getElementById('strengthBar');
      const strengthText = document.getElementById('strengthText');

      const requirements = {
        length: { regex: /.{8,}/, element: document.getElementById('req_length') },
        uppercase: { regex: /[A-Z]/, element: document.getElementById('req_uppercase') },
        lowercase: { regex: /[a-z]/, element: document.getElementById('req_lowercase') },
        number: { regex: /[0-9]/, element: document.getElementById('req_number') },
        special: { regex: /[!@#$%^&*(),.?":{}|<>]/, element: document.getElementById('req_special') }
      };

      if (regPassword) {
        regPassword.addEventListener('focus', function() {
          passwordRequirements.style.display = 'block';
        });

        regPassword.addEventListener('input', function() {
          const password = this.value;
          let metCount = 0;

          if (password.length > 0) {
            passwordStrength.style.display = 'block';
          } else {
            passwordStrength.style.display = 'none';
            passwordRequirements.style.display = 'none';
            return;
          }

          // Check each requirement
          Object.keys(requirements).forEach(key => {
            const req = requirements[key];
            const met = req.regex.test(password);
            
            if (met) {
              req.element.style.color = '#10b981';
              req.element.querySelector('box-icon').setAttribute('name', 'check-circle');
              metCount++;
            } else {
              req.element.style.color = 'rgba(255,255,255,0.6)';
              req.element.querySelector('box-icon').setAttribute('name', 'x-circle');
            }
          });

          // Update strength bar
          strengthBar.style.width = '0%';
          if (metCount <= 2) {
            strengthBar.style.width = '33%';
            strengthBar.style.background = '#ef4444';
            strengthText.textContent = 'Weak password';
            strengthText.style.color = '#ef4444';
          } else if (metCount <= 4) {
            strengthBar.style.width = '66%';
            strengthBar.style.background = '#f59e0b';
            strengthText.textContent = 'Medium password';
            strengthText.style.color = '#f59e0b';
          } else {
            strengthBar.style.width = '100%';
            strengthBar.style.background = '#10b981';
            strengthText.textContent = 'Strong password';
            strengthText.style.color = '#10b981';
          }
        });
      }

      // Form validation
      const registerForm = document.querySelector('.form-box.Register form');
      if (registerForm) {
        registerForm.addEventListener('submit', function(e) {
          let isValid = true;
          const name = document.getElementById('reg_name');
          const email = document.getElementById('reg_email');
          const password = document.getElementById('reg_password');
          const confirmPassword = document.getElementById('reg_confirm_password');

          // Clear previous errors
          document.querySelectorAll('.error-message').forEach(el => el.style.display = 'none');

          // Validate name
          if (!name.value.trim() || name.value.trim().length < 2) {
            document.getElementById('reg_name_error') && (document.getElementById('reg_name_error').textContent = 'Name must be at least 2 characters');
            isValid = false;
          }

          // Validate email
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          if (!emailRegex.test(email.value)) {
            document.getElementById('reg_email_error') && (document.getElementById('reg_email_error').textContent = 'Please enter a valid email');
            isValid = false;
          }

          // Validate password strength
          let passwordValid = true;
          Object.keys(requirements).forEach(key => {
            if (!requirements[key].regex.test(password.value)) {
              passwordValid = false;
            }
          });

          if (!passwordValid) {
            const errorEl = document.getElementById('reg_password_error');
            if (errorEl) {
              errorEl.textContent = 'Password does not meet all requirements';
              errorEl.style.display = 'block';
            }
            isValid = false;
          }

          // Validate password confirmation
          if (password.value !== confirmPassword.value) {
            const errorEl = document.getElementById('reg_confirm_password_error');
            if (errorEl) {
              errorEl.textContent = 'Passwords do not match';
              errorEl.style.display = 'block';
            }
            isValid = false;
          }

          if (!isValid) {
            e.preventDefault();
            return false;
          }

          // Show loading state
          const btn = document.getElementById('registerBtn');
          if (btn) {
            btn.disabled = true;
            btn.textContent = 'Creating account...';
          }
        });
      }

      // Mobile Login Enhancement
      const form = document.getElementById('loginForm');
      const btn = document.getElementById('loginBtn');
      const emailInput = document.getElementById('email');
      const passwordInput = document.getElementById('password');
      
      if (form && btn) {
        // Prevent double submission
        let isSubmitting = false;
        
        // Add visual feedback on mobile
        btn.addEventListener('touchstart', function(e) {
          this.style.opacity = '0.8';
        }, {passive: true});
        
        btn.addEventListener('touchend', function(e) {
          this.style.opacity = '1';
        }, {passive: true});
        
        // Handle form submission - use standard form submission
        form.addEventListener('submit', function(e) {
          // Prevent double submission
          if (isSubmitting) {
            e.preventDefault();
            return false;
          }
          
          const email = emailInput.value.trim();
          const password = passwordInput.value;
          
          // Validation
          if (!email || !password) {
            e.preventDefault();
            alert('Please enter both email and password');
            return false;
          }
          
          // Show loading state
          isSubmitting = true;
          btn.textContent = 'Logging in...';
          btn.disabled = true;
          btn.style.opacity = '0.7';
          
          // Let form submit normally
          return true;
        });
        
        // Fix iOS Safari input issues
        [emailInput, passwordInput].forEach(input => {
          if (input) {
            input.addEventListener('focus', function() {
              // Scroll input into view on mobile
              setTimeout(() => {
                this.scrollIntoView({behavior: 'smooth', block: 'center'});
              }, 300);
            });
          }
        });
      }
    });
  </script>
</body>
</html>
