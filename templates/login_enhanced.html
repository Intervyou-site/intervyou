<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - IntervYou</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .auth-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            max-width: 450px;
            width: 100%;
            animation: slideUp 0.5s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .auth-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 40px 30px;
            text-align: center;
            color: white;
        }

        .auth-header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .auth-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .auth-body {
            padding: 40px 30px;
        }

        .form-group {
            margin-bottom: 24px;
            position: relative;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #374151;
            font-size: 14px;
        }

        .form-group label .required {
            color: #ef4444;
        }

        .input-wrapper {
            position: relative;
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            padding-left: 45px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 15px;
            transition: all 0.3s;
            outline: none;
        }

        .form-control:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .form-control.error {
            border-color: #ef4444;
        }

        .form-control.success {
            border-color: #10b981;
        }

        .input-icon {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #9ca3af;
            font-size: 20px;
        }

        .toggle-password {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #9ca3af;
            font-size: 20px;
            transition: color 0.3s;
        }

        .toggle-password:hover {
            color: #667eea;
        }

        .error-message {
            color: #ef4444;
            font-size: 13px;
            margin-top: 6px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .password-strength {
            margin-top: 10px;
            display: none;
        }

        .password-strength.show {
            display: block;
        }

        .strength-bar {
            height: 4px;
            background: #e5e7eb;
            border-radius: 2px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .strength-bar-fill {
            height: 100%;
            width: 0%;
            transition: all 0.3s;
            border-radius: 2px;
        }

        .strength-bar-fill.weak {
            width: 33%;
            background: #ef4444;
        }

        .strength-bar-fill.medium {
            width: 66%;
            background: #f59e0b;
        }

        .strength-bar-fill.strong {
            width: 100%;
            background: #10b981;
        }

        .strength-text {
            font-size: 12px;
            color: #6b7280;
        }

        .password-requirements {
            margin-top: 10px;
            padding: 12px;
            background: #f9fafb;
            border-radius: 8px;
            font-size: 12px;
            display: none;
        }

        .password-requirements.show {
            display: block;
        }

        .requirement {
            display: flex;
            align-items: center;
            margin-bottom: 6px;
            color: #6b7280;
        }

        .requirement:last-child {
            margin-bottom: 0;
        }

        .requirement.met {
            color: #10b981;
        }

        .requirement i {
            margin-right: 8px;
            font-size: 16px;
        }

        .btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 30px 0;
            color: #9ca3af;
            font-size: 14px;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: #e5e7eb;
        }

        .divider span {
            padding: 0 15px;
        }

        .social-login {
            display: flex;
            gap: 12px;
        }

        .social-btn {
            flex: 1;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
            color: #374151;
            font-weight: 500;
        }

        .social-btn:hover {
            border-color: #667eea;
            background: #f9fafb;
        }

        .auth-footer {
            text-align: center;
            margin-top: 24px;
            color: #6b7280;
            font-size: 14px;
        }

        .auth-footer a {
            color: #667eea;
            text-decoration: none;
            font-weight: 600;
        }

        .auth-footer a:hover {
            text-decoration: underline;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border: 1px solid #fecaca;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border: 1px solid #a7f3d0;
        }

        .home-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            text-decoration: none;
            color: #667eea;
            font-size: 24px;
            transition: all 0.3s;
        }

        .home-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
        }

        @media (max-width: 640px) {
            .auth-container {
                margin: 0;
            }

            .auth-header {
                padding: 30px 20px;
            }

            .auth-body {
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <a href="/" class="home-btn">
        <i class='bx bx-home'></i>
    </a>

    <div class="auth-container">
        <div class="auth-header">
            <h1 id="authTitle">Welcome Back</h1>
            <p id="authSubtitle">Sign in to continue your interview preparation</p>
        </div>

        <div class="auth-body">
            {% if flashes %}
                {% for flash in flashes %}
                    <div class="alert alert-{{ 'error' if 'error' in flash.msg.lower() or 'invalid' in flash.msg.lower() or 'failed' in flash.msg.lower() else 'success' }}">
                        <i class='bx bx-{{ 'error-circle' if 'error' in flash.msg.lower() or 'invalid' in flash.msg.lower() or 'failed' in flash.msg.lower() else 'check-circle' }}'></i>
                        <span>{{ flash.msg }}</span>
                    </div>
                {% endfor %}
            {% endif %}

            <!-- LOGIN FORM -->
            <form id="loginForm" action="/login" method="POST" style="display: block;">
                <div class="form-group">
                    <label for="login_email">Email Address <span class="required">*</span></label>
                    <div class="input-wrapper">
                        <i class='bx bx-envelope input-icon'></i>
                        <input 
                            type="email" 
                            id="login_email" 
                            name="email" 
                            class="form-control" 
                            placeholder="Enter your email"
                            required
                            autocomplete="email"
                        >
                    </div>
                    <div class="error-message" id="login_email_error"></div>
                </div>

                <div class="form-group">
                    <label for="login_password">Password <span class="required">*</span></label>
                    <div class="input-wrapper">
                        <i class='bx bx-lock-alt input-icon'></i>
                        <input 
                            type="password" 
                            id="login_password" 
                            name="password" 
                            class="form-control" 
                            placeholder="Enter your password"
                            required
                            autocomplete="current-password"
                        >
                        <i class='bx bx-hide toggle-password' id="toggleLoginPassword"></i>
                    </div>
                    <div class="error-message" id="login_password_error"></div>
                </div>

                <div style="text-align: right; margin-bottom: 20px;">
                    <a href="/forgot_password" style="color: #667eea; text-decoration: none; font-size: 14px; font-weight: 500;">Forgot Password?</a>
                </div>

                <button type="submit" class="btn" id="loginBtn">Sign In</button>
            </form>

            <!-- REGISTER FORM -->
            <form id="registerForm" action="/register" method="POST" style="display: none;">
                <div class="form-group">
                    <label for="register_name">Full Name <span class="required">*</span></label>
                    <div class="input-wrapper">
                        <i class='bx bx-user input-icon'></i>
                        <input 
                            type="text" 
                            id="register_name" 
                            name="name" 
                            class="form-control" 
                            placeholder="Enter your full name"
                            required
                            autocomplete="name"
                            minlength="2"
                        >
                    </div>
                    <div class="error-message" id="register_name_error"></div>
                </div>

                <div class="form-group">
                    <label for="register_email">Email Address <span class="required">*</span></label>
                    <div class="input-wrapper">
                        <i class='bx bx-envelope input-icon'></i>
                        <input 
                            type="email" 
                            id="register_email" 
                            name="email" 
                            class="form-control" 
                            placeholder="Enter your email"
                            required
                            autocomplete="email"
                        >
                    </div>
                    <div class="error-message" id="register_email_error"></div>
                </div>

                <div class="form-group">
                    <label for="register_password">Password <span class="required">*</span></label>
                    <div class="input-wrapper">
                        <i class='bx bx-lock-alt input-icon'></i>
                        <input 
                            type="password" 
                            id="register_password" 
                            name="password" 
                            class="form-control" 
                            placeholder="Create a strong password"
                            required
                            autocomplete="new-password"
                        >
                        <i class='bx bx-hide toggle-password' id="toggleRegisterPassword"></i>
                    </div>
                    <div class="error-message" id="register_password_error"></div>
                    
                    <!-- Password Strength Meter -->
                    <div class="password-strength" id="passwordStrength">
                        <div class="strength-bar">
                            <div class="strength-bar-fill" id="strengthBarFill"></div>
                        </div>
                        <div class="strength-text" id="strengthText"></div>
                    </div>

                    <!-- Password Requirements -->
                    <div class="password-requirements" id="passwordRequirements">
                        <div class="requirement" id="req_length">
                            <i class='bx bx-x-circle'></i>
                            <span>At least 8 characters</span>
                        </div>
                        <div class="requirement" id="req_uppercase">
                            <i class='bx bx-x-circle'></i>
                            <span>One uppercase letter</span>
                        </div>
                        <div class="requirement" id="req_lowercase">
                            <i class='bx bx-x-circle'></i>
                            <span>One lowercase letter</span>
                        </div>
                        <div class="requirement" id="req_number">
                            <i class='bx bx-x-circle'></i>
                            <span>One number</span>
                        </div>
                        <div class="requirement" id="req_special">
                            <i class='bx bx-x-circle'></i>
                            <span>One special character (!@#$%^&*)</span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="register_confirm_password">Confirm Password <span class="required">*</span></label>
                    <div class="input-wrapper">
                        <i class='bx bx-lock-alt input-icon'></i>
                        <input 
                            type="password" 
                            id="register_confirm_password" 
                            name="confirm_password" 
                            class="form-control" 
                            placeholder="Confirm your password"
                            required
                            autocomplete="new-password"
                        >
                        <i class='bx bx-hide toggle-password' id="toggleConfirmPassword"></i>
                    </div>
                    <div class="error-message" id="register_confirm_password_error"></div>
                </div>

                <button type="submit" class="btn" id="registerBtn">Create Account</button>
            </form>

            <!-- Social Login -->
            <div class="divider">
                <span>Or continue with</span>
            </div>

            <div class="social-login">
                <a href="/auth/google" class="social-btn">
                    <i class='bx bxl-google' style="font-size: 20px; color: #DB4437;"></i>
                    <span>Google</span>
                </a>
            </div>

            <!-- Toggle Between Login/Register -->
            <div class="auth-footer">
                <p id="toggleText">
                    Don't have an account? 
                    <a href="#" id="toggleLink">Sign Up</a>
                </p>
            </div>
        </div>
    </div>

    <script>
        // Toggle between login and register
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const authTitle = document.getElementById('authTitle');
        const authSubtitle = document.getElementById('authSubtitle');
        const toggleText = document.getElementById('toggleText');
        const toggleLink = document.getElementById('toggleLink');

        let isLogin = true;

        toggleLink.addEventListener('click', (e) => {
            e.preventDefault();
            isLogin = !isLogin;

            if (isLogin) {
                loginForm.style.display = 'block';
                registerForm.style.display = 'none';
                authTitle.textContent = 'Welcome Back';
                authSubtitle.textContent = 'Sign in to continue your interview preparation';
                toggleText.innerHTML = 'Don\'t have an account? <a href="#" id="toggleLink">Sign Up</a>';
            } else {
                loginForm.style.display = 'none';
                registerForm.style.display = 'block';
                authTitle.textContent = 'Create Account';
                authSubtitle.textContent = 'Start your interview preparation journey';
                toggleText.innerHTML = 'Already have an account? <a href="#" id="toggleLink">Sign In</a>';
            }

            // Re-attach event listener
            document.getElementById('toggleLink').addEventListener('click', arguments.callee);
        });

        // Password visibility toggle
        function setupPasswordToggle(toggleId, inputId) {
            const toggle = document.getElementById(toggleId);
            const input = document.getElementById(inputId);

            toggle.addEventListener('click', () => {
                const type = input.type === 'password' ? 'text' : 'password';
                input.type = type;
                toggle.classList.toggle('bx-hide');
                toggle.classList.toggle('bx-show');
            });
        }

        setupPasswordToggle('toggleLoginPassword', 'login_password');
        setupPasswordToggle('toggleRegisterPassword', 'register_password');
        setupPasswordToggle('toggleConfirmPassword', 'register_confirm_password');

        // Email validation
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // Password strength checker
        const registerPassword = document.getElementById('register_password');
        const passwordStrength = document.getElementById('passwordStrength');
        const passwordRequirements = document.getElementById('passwordRequirements');
        const strengthBarFill = document.getElementById('strengthBarFill');
        const strengthText = document.getElementById('strengthText');

        const requirements = {
            length: { regex: /.{8,}/, element: document.getElementById('req_length') },
            uppercase: { regex: /[A-Z]/, element: document.getElementById('req_uppercase') },
            lowercase: { regex: /[a-z]/, element: document.getElementById('req_lowercase') },
            number: { regex: /[0-9]/, element: document.getElementById('req_number') },
            special: { regex: /[!@#$%^&*(),.?":{}|<>]/, element: document.getElementById('req_special') }
        };

        registerPassword.addEventListener('focus', () => {
            passwordRequirements.classList.add('show');
        });

        registerPassword.addEventListener('input', () => {
            const password = registerPassword.value;
            let metCount = 0;

            passwordStrength.classList.add('show');

            // Check each requirement
            Object.keys(requirements).forEach(key => {
                const req = requirements[key];
                const met = req.regex.test(password);
                
                if (met) {
                    req.element.classList.add('met');
                    req.element.querySelector('i').className = 'bx bx-check-circle';
                    metCount++;
                } else {
                    req.element.classList.remove('met');
                    req.element.querySelector('i').className = 'bx bx-x-circle';
                }
            });

            // Update strength bar
            strengthBarFill.className = 'strength-bar-fill';
            if (metCount <= 2) {
                strengthBarFill.classList.add('weak');
                strengthText.textContent = 'Weak password';
                strengthText.style.color = '#ef4444';
            } else if (metCount <= 4) {
                strengthBarFill.classList.add('medium');
                strengthText.textContent = 'Medium password';
                strengthText.style.color = '#f59e0b';
            } else {
                strengthBarFill.classList.add('strong');
                strengthText.textContent = 'Strong password';
                strengthText.style.color = '#10b981';
            }
        });

        // Form validation
        loginForm.addEventListener('submit', (e) => {
            let isValid = true;
            const email = document.getElementById('login_email');
            const password = document.getElementById('login_password');

            // Reset errors
            document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
            document.querySelectorAll('.form-control').forEach(el => {
                el.classList.remove('error');
                el.classList.remove('success');
            });

            // Validate email
            if (!email.value.trim()) {
                showError('login_email', 'Email is required');
                isValid = false;
            } else if (!validateEmail(email.value)) {
                showError('login_email', 'Please enter a valid email');
                isValid = false;
            } else {
                email.classList.add('success');
            }

            // Validate password
            if (!password.value) {
                showError('login_password', 'Password is required');
                isValid = false;
            } else {
                password.classList.add('success');
            }

            if (!isValid) {
                e.preventDefault();
            } else {
                document.getElementById('loginBtn').disabled = true;
                document.getElementById('loginBtn').textContent = 'Signing in...';
            }
        });

        registerForm.addEventListener('submit', (e) => {
            let isValid = true;
            const name = document.getElementById('register_name');
            const email = document.getElementById('register_email');
            const password = document.getElementById('register_password');
            const confirmPassword = document.getElementById('register_confirm_password');

            // Reset errors
            document.querySelectorAll('.error-message').forEach(el => el.classList.remove('show'));
            document.querySelectorAll('.form-control').forEach(el => {
                el.classList.remove('error');
                el.classList.remove('success');
            });

            // Validate name
            if (!name.value.trim()) {
                showError('register_name', 'Name is required');
                isValid = false;
            } else if (name.value.trim().length < 2) {
                showError('register_name', 'Name must be at least 2 characters');
                isValid = false;
            } else {
                name.classList.add('success');
            }

            // Validate email
            if (!email.value.trim()) {
                showError('register_email', 'Email is required');
                isValid = false;
            } else if (!validateEmail(email.value)) {
                showError('register_email', 'Please enter a valid email');
                isValid = false;
            } else {
                email.classList.add('success');
            }

            // Validate password
            let passwordValid = true;
            Object.keys(requirements).forEach(key => {
                if (!requirements[key].regex.test(password.value)) {
                    passwordValid = false;
                }
            });

            if (!password.value) {
                showError('register_password', 'Password is required');
                isValid = false;
            } else if (!passwordValid) {
                showError('register_password', 'Password does not meet all requirements');
                isValid = false;
            } else {
                password.classList.add('success');
            }

            // Validate confirm password
            if (!confirmPassword.value) {
                showError('register_confirm_password', 'Please confirm your password');
                isValid = false;
            } else if (password.value !== confirmPassword.value) {
                showError('register_confirm_password', 'Passwords do not match');
                isValid = false;
            } else {
                confirmPassword.classList.add('success');
            }

            if (!isValid) {
                e.preventDefault();
            } else {
                document.getElementById('registerBtn').disabled = true;
                document.getElementById('registerBtn').textContent = 'Creating account...';
            }
        });

        function showError(fieldId, message) {
            const field = document.getElementById(fieldId);
            const error = document.getElementById(fieldId + '_error');
            field.classList.add('error');
            error.textContent = message;
            error.classList.add('show');
        }
    </script>
</body>
</html>
